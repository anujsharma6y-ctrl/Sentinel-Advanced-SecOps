import requests
import hashlib

# 1. API Configuration
# Note: You get this key by signing up on VirusTotal (it's free!)
API_KEY = "YOUR_API_KEY_HERE"
VT_URL = "https://www.virustotal.com/api/v3/files/"

def get_file_hash(file_path):
    """Calculates the SHA-256 hash of a file."""
    sha256_hash = hashlib.sha256()
    with open(file_path, "rb") as f:
        # Read file in chunks so we don't crash on large files
        for byte_block in iter(lambda: f.read(4096), b""):
            sha256_hash.update(byte_block)
    return sha256_hash.hexdigest()

def check_malware(file_hash):
    """Queries VirusTotal for the file hash."""
    headers = {"x-apikey": API_KEY}
    response = requests.get(VT_URL + file_hash, headers=headers)

    if response.status_code == 200:
        result = response.json()
        stats = result['data']['attributes']['last_analysis_stats']
        print(f"\n Scan Results for Hash: {file_hash}")
        print(f" Harmless: {stats['harmless']}")
        print(f" Malicious: {stats['malicious']}")
        print(f"  Suspicious: {stats['suspicious']}")
    elif response.status_code == 404:
        print(" Hash not found in VirusTotal database. It might be a new file.")
    else:
        print(f" Error: Could not connect to API (Status: {response.status_code})")

# Usage (Example)
# hash_val = get_file_hash("test_file.exe")
# check_malware(hash_val)
